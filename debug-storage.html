<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Storage - Tinnitus Care</title>
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/global.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a href="index.html" class="btn btn-secondary btn-sm">â† Volver</a>
        <h1>ğŸ” Debug Storage</h1>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <div class="card mb-4">
        <h2 class="mb-4">ğŸ—„ï¸ Contenido de LocalStorage</h2>

        <div class="mb-4">
          <button class="btn btn-primary" onclick="loadData()">ğŸ”„ Recargar Datos</button>
          <button class="btn btn-warning" onclick="clearAllData()">ğŸ—‘ï¸ Limpiar Todo</button>
        </div>

        <div id="storage-content"></div>
      </div>
    </div>
  </main>

  <script src="js/storage.js"></script>

  <script>
    function formatJSON(obj) {
      return JSON.stringify(obj, null, 2);
    }

    function loadData() {
      const content = document.getElementById('storage-content');

      let html = '<div style="font-family: monospace; font-size: 0.9em;">';

      // Get all storage keys
      const keys = [
        'tinnitus_user_profile',
        'tinnitus_audiometry_results',
        'tinnitus_tinnitus_match',
        'tinnitus_treatment_sessions'
      ];

      keys.forEach(key => {
        const data = localStorage.getItem(key);
        html += `
          <div style="margin-bottom: 2rem; padding: 1rem; background: #f5f5f5; border-radius: 8px;">
            <h3 style="color: #333; margin-bottom: 1rem;">ğŸ“¦ ${key}</h3>
            ${data ? `
              <pre style="background: white; padding: 1rem; border-radius: 4px; overflow-x: auto; max-height: 400px; overflow-y: auto;">${formatJSON(JSON.parse(data))}</pre>
            ` : `
              <p style="color: #999; font-style: italic;">No data</p>
            `}
          </div>
        `;
      });

      // Check using Storage helper
      html += '<div style="margin-top: 2rem; padding: 1rem; background: #e3f2fd; border-radius: 8px;">';
      html += '<h3 style="color: #1976d2; margin-bottom: 1rem;">ğŸ”§ Using Storage Helper</h3>';

      const audiometry = Storage.getLatestAudiometryResults();
      html += `
        <div style="margin-bottom: 1rem;">
          <strong>Storage.getLatestAudiometryResults():</strong>
          <pre style="background: white; padding: 1rem; margin-top: 0.5rem; border-radius: 4px; overflow-x: auto;">${audiometry ? formatJSON(audiometry) : 'null'}</pre>
        </div>
      `;

      const tinnitusMatch = Storage.getTinnitusMatch();
      html += `
        <div style="margin-bottom: 1rem;">
          <strong>Storage.getTinnitusMatch():</strong>
          <pre style="background: white; padding: 1rem; margin-top: 0.5rem; border-radius: 4px; overflow-x: auto;">${tinnitusMatch ? formatJSON(tinnitusMatch) : 'null'}</pre>
        </div>
      `;

      html += '</div>';
      html += '</div>';

      content.innerHTML = html;

      // Log to console as well
      console.group('ğŸ—„ï¸ LocalStorage Debug');
      console.log('Latest Audiometry:', audiometry);
      console.log('Tinnitus Match:', tinnitusMatch);
      console.groupEnd();
    }

    function clearAllData() {
      if (confirm('âš ï¸ Â¿EstÃ¡s seguro de que quieres borrar TODOS los datos?\n\nEsto eliminarÃ¡:\n- Resultados de audiometrÃ­a\n- BÃºsqueda de tinnitus\n- Sesiones de tratamiento\n\nEsta acciÃ³n NO se puede deshacer.')) {
        localStorage.clear();
        console.log('âœ… LocalStorage limpiado');
        alert('âœ… Todos los datos han sido eliminados');
        loadData();
      }
    }

    // Auto-load on page load
    window.addEventListener('DOMContentLoaded', loadData);
  </script>

  <style>
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</body>
</html>
